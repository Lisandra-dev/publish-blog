---  
category: Computer Science ğŸ’»/OS  
share: true  
date created: Monday, January 16th 2023, 3:20:49 pm  
date modified: Wednesday, January 18th 2023, 5:04:26 pm  
---  
  
  
  
# Lottery Scheduling   
## ìŠ¤ì¼€ì¤„ë§ : ë¹„ë¡€ ë°°ë¶„  
**ë¹„ë¡€ ë°°ë¶„(Proportional Share)** ìŠ¤ì¼€ì¤„ëŸ¬, í˜¹ì€ **ê³µì • ë°°ë¶„(fair share)** ì´ë¼ê³ ë„ í•˜ëŠ” ìœ í˜•ì˜ ìŠ¤ì¼€ì¤„ëŸ¬  
  
> **í•µì‹¬ ì§ˆë¬¸ : ì–´ë–»ê²Œ CPUë¥¼ ì •í•´ì§„ ë¹„ìœ¨ë¡œ ë°°ë¶„í•  ìˆ˜ ìˆëŠ”ê°€**   
> - íŠ¹ì • ë¹„ìœ¨ë¡œ CPUë¥¼ ë°°ë¶„í•˜ëŠ” ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì–´ë–»ê²Œ ì„¤ê³„í•  ìˆ˜ ìˆëŠ”ê°€?   
> - ê·¸ë ‡ê²Œ í•˜ê¸° ìœ„í•œ ì¤‘ìš”í•œ ê¸°ë²•ì€ ë¬´ì—‡ì¸ê°€?   
> - ê·¸ ê¸°ë²•ì€ ì–¼ë§ˆë‚˜ íš¨ê³¼ì ì¸ê°€?   
  
- ë¹„ë¡€ ë°°ë¶„  
ë°˜í™˜ ì‹œê°„ì´ë‚˜ ì‘ë‹µ ì‹œê°„ì„ ìµœì í™”í•˜ëŠ” ëŒ€ì‹  ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ê° ì‘ì—…ì—ê²Œ CPUì˜ ì¼ì • ë¹„ìœ¨ì„ ë³´ì¥  
  
  
  
ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§(lottery scheduling)  
ë‹¤ìŒ ì‹¤í–‰ë  í”„ë¡œì„¸ìŠ¤ë¥¼ ì¶”ì²¨ì„ í†µí•´ ê²°ì •í•œë‹¤.  
ë” ìì£¼ ìˆ˜í–‰ë˜ì–´ì•¼ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤ëŠ” ë‹¹ì²¨ ê¸°íšŒë¥¼ ë” ë§ì´ ì¤€ë‹¤.  
  
  
  
# 1. ê¸°ë³¸ ê°œë… : ì¶”ì²¨ê¶Œê³¼ ë¬´ì‘ìœ„ì„±  
  
> **íŒ : ë¬´ì‘ìœ„ì„±ì˜ ì´ìš©**  
> ì¶”ì²¨ê¶Œ ìŠ¤ì¼€ì¤„ë§ì˜ í° ì¥ì  ì¤‘ í•˜ë‚˜ëŠ” **ë¬´ì‘ìœ„ì„±**ì´ë‹¤.  
> ë¬´ì‘ìœ„ ë°©ì‹ì€ ì „í†µì ì¸ ê²°ì • ë°©ì‹ì— ë¹„í•´ ì„¸ ê°€ì§€ ì¥ì ì´ ìˆë‹¤.   
> 1. ë¬´ì‘ìœ„ ë°©ì‹ì€ ë” ì „í†µì ì¸ ë°©ì‹ì´ ì˜ í•´ê²°í•˜ì§€ ëª»í•˜ëŠ” íŠ¹ì´ ìƒí™©ì„ ì˜ ëŒ€ì‘í•œë‹¤.   
>   LRU êµì²´ ì •ì±…ì„ ìƒê°í•´ ë³´ì (ê°€ìƒ ë©”ëª¨ë¦¬ì˜ ë‚˜ì¤‘ ì¥ì—ì„œ ë” ìì„¸íˆ ê²€í† ).   
>   LRUëŠ” ì¢‹ì€ êµì²´ ì•Œê³ ë¦¬ì¦˜ì´ì§€ë§Œ ë°˜ë³µë˜ëŠ” ìˆœì°¨ì ì¸ ì ‘ê·¼ íŒ¨í„´ì„ ë³´ì´ëŠ” ì˜¤ë²„í—¤ë“œì— ëŒ€í•´ì„œëŠ” ìµœì•…ì˜ ì„±ëŠ¥ì„ ë³´ì¸ë‹¤.   
>   ë°˜ë©´, ë¬´ì‘ìœ„ ë°©ì‹ì—ì„œëŠ” ê·¸ëŸ¬í•œ ìµœì•…ì˜ ê²½ìš°ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.   
> 2. ë¬´ì‘ìœ„ ì¶”ì²¨ ë°©ì‹ì€ ë§¤ìš° ê°€ë³ë‹¤.   
>   ê´€ë¦¬í•´ì•¼ í•  ìƒíƒœ ì •ë³´ê°€ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.   
>   ì „í†µì ì¸ ê³µì • ë°°ë¶„ ìŠ¤ì¼€ì¤„ë§ ì•Œê³ ë¦¬ì¦˜ì—ì„œëŠ” ê° í”„ë¡œì„¸ìŠ¤ê°€ ì‚¬ìš©í•œ CPU ì–‘ì„ ê¸°ë¡í•´ì•¼ í•œë‹¤.  
>   ì´ ì •ë³´ëŠ” ê° í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•Œë§ˆë‹¤ ê°±ì‹ ëœë‹¤.   
>   ë¬´ì‘ìœ„ ì¶”ì²¨ ë°©ì‹ì—ì„œëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ìƒíƒœ ì •ë³´ë§Œ í•„ìš”í•˜ë‹¤ (ì˜ˆ, ê° í”„ë¡œì„¸ìŠ¤ê°€ ê°€ì§„ ì¶”ì²¨ê¶Œì˜ ê°œìˆ˜).   
> 3. ë¬´ì‘ìœ„ ì¶”ì²¨ ë°©ì‹ì€ ë§¤ìš° ë¹ ë¥´ë‹¤.   
>   ë‚œìˆ˜ ë°œìƒ ì‹œê°„ì´ ë¹ ë¥´ê¸°ë§Œ í•˜ë©´ ê²°ì • ì—­ì‹œ ë¹ ë¥´ê²Œ ë˜ê³  ë”°ë¼ì„œ ì†ë„ê°€ ìš”êµ¬ë˜ëŠ” ë§ì€ ê²½ìš°ì— ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.   
>   ë¬¼ë¡ , ì†ë„ë¥¼ ì¦ê°€ì‹œí‚¤ê¸° ìœ„í•´ì„œ ì¶”ì²¨ ê³¼ì •ì„ ëœ ë¬´ì‘ìœ„ (pseudo-random)í•˜ê²Œ ë§Œë“¤ê¸°ë„ í•œë‹¤.  
  
  
- **Tickets (ì¶”ì²¨ê¶Œ, í‹°ì¼“)**  
	ì¶”ì²¨ê¶Œì€ í”„ë¡œì„¸ìŠ¤ê°€ (ë˜ëŠ” ì‚¬ìš©ì ë˜ëŠ” ê·¸ ë¬´ì—‡ì´ë“ ) ë°›ì•„ì•¼ í•  ìì›ì˜ ëª«ì„ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©ëœë‹¤.  
	í”„ë¡œì„¸ìŠ¤ê°€ ì†Œìœ í•œ í‹°ì¼“ì˜ ê°œìˆ˜ì™€ ì „ì²´ í‹°ì¼“ì— ëŒ€í•œ ë¹„ìœ¨ì´ ìì‹ ì˜ ëª«ì„ ë‚˜íƒ€ë‚¸ë‹¤.   
  
- **ì˜ˆì‹œ**  
ì¶”ì²¨ê¶Œì€ 0 ì—ì„œ 99ì˜ ìˆ«ìë‹¤.  
Aì™€ B ë‘ í”„ë¡œì„¸ìŠ¤ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì.   
AëŠ” 75ì¥ì˜ ì¶”ì²¨ê¶Œ (í‹°ì¼“ 0 ~ 74) â†’  75%ì˜ CPU í• ë‹¹  
B ëŠ” 25ì¥ì˜ ì¶”ì²¨ê¶Œ (í‹°ì¼“ 75 ~99) â†’ ë‚¨ì€ 25% CPU í• ë‹¹  
  
  
ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ì¶”ì²¨ê¶Œì„ ì„ íƒí•˜ê³  ë½‘íŒ ì¶”ì²¨ê¶Œ ê°’ì— ë”°ë¼ ì‹¤í–‰í•  í”„ë¡œì„¸ìŠ¤ê°€ ê²°ì •ëœë‹¤.  
  
![[../../assets/img/Pasted image 20230115113813.png|Pasted image 20230115113813.png]]  
  
  
  
  
ë¬´ì‘ìœ„ì„±ì€ ì›í•˜ëŠ” ë¹„ìœ¨ì„ ì •í™•íˆ ë³´ì¥í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.   
í•˜ì§€ë§Œ, ë‘ ì‘ì—…ì´ ì¥ì‹œê°„ ì‹¤í–‰ë ìˆ˜ë¡, ì›í•˜ëŠ” ë¹„ìœ¨ì„ ë‹¬ì„±í•  ê°€ëŠ¥ì„±ì´ ë†’ì•„ì§„ë‹¤.   
  
# 2. ì¶”ì²¨ ê¸°ë²•  
  
> **íŒ : ëª«ì„ í‘œí˜„í•˜ê¸° ìœ„í•œ ì¶”ì²¨ê¶Œì˜ ì‚¬ìš©**   
> ì¶”ì²¨ (ê·¸ë¦¬ê³  ë³´í­ (stride)) ìŠ¤ì¼€ì¤„ë§ì˜ ì„¤ê³„ì—ì„œ ê°€ì¥ ê¸°ë³¸ì ì¸ ê°œë…ì€ **ì¶”ì²¨ê¶Œ**ì´ë‹¤.   
> ì´ ì˜ˆì—ì„œëŠ” ì¶”ì²¨ê¶Œì´ CPUë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œì„¸ìŠ¤ì˜ ëª«ì„ ë‚˜íƒ€ë‚´ëŠ” ë° ì‚¬ìš©ë˜ê³  ìˆì§€ë§Œ í›¨ì”¬ ë” ë„ë¦¬ ì ìš©ë  ìˆ˜ ìˆë‹¤.   
> ì˜ˆë¥¼ ë“¤ì–´, í•˜ì´í¼ë°”ì´ì €ì˜ ê°€ìƒ ë©”ëª¨ë¦¬ ê´€ë¦¬ì— ê´€í•œ ìµœê·¼ì˜ ì—°êµ¬ì—ì„œ WaldspurgerëŠ” ê²ŒìŠ¤íŠ¸ ìš´ì˜ì²´ì œì˜ ë©”ëª¨ë¦¬ í• ë‹¹ ì§€ë¶„ì„ ë‚˜íƒ€ë‚´ëŠ” ë° ì¶”ì²¨ê¶Œì´ ì–´ë–»ê²Œ ì‚¬ìš©ë  ìˆ˜ ìˆëŠ”ì§€ ë³´ì—¬ ì¤€ë‹¤.   
> ì¶”ì²¨ê¶Œì„ í†µí•´ì„œ í˜„ì¬ ì†Œìœ  ì§€ë¶„ì„ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.  
  
  
- **ì¶”ì²¨ê¶Œ í™”í (ticket currency)**  
ì´ ê°œë…ì€ ì‚¬ìš©ìê°€ ì¶”ì²¨ê¶Œì„ ìì‹ ì˜ í™”í ê°€ì¹˜ë¡œ ì¶”ì²¨ê¶Œì„ ììœ ë¡­ê²Œ í• ë‹¹í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•œë‹¤.  
ì‹œìŠ¤í…œì€ ìë™ì ìœ¼ë¡œ í™”í ê°€ì¹˜ë¥¼ correct global valueë¡œ ë³€í™˜í•œë‹¤.  
  
  
- **ì˜ˆì‹œ**  
ì‚¬ìš©ì A, Bê°€ ê°ê° 100ì¥ì˜ ì¶”ì²¨ê¶Œì„ ë°›ì•˜ë‹¤ê³  ê°€ì •í•˜ì. (Global currency = 200)  
  
`ì‚¬ìš©ì A`  
A1ê³¼ A2ì˜ ë‘ ê°œì˜ ì‘ì—…ì„ ì‹¤í–‰ ì¤‘  
ì‚¬ìš©ì ê¸°ì¤€ ì „ì²´ í™”í = 1000ì¥ì˜ ì¶”ì²¨ê¶Œ â†’ ê°ê° 500ì¥ì˜ ì¶”ì²¨ê¶Œì„ í• ë‹¹   
â†’ ì‹œìŠ¤í…œì€ A1ê³¼ A2ì˜ ëª«ì„ Aì˜ ê¸°ì¤€ `í™”í 500ì¥`ì—ì„œ `ì „ì—­ ê¸°ì¤€ í™”í ê°ê° 50ì¥`ìœ¼ë¡œ ë³€í™˜í•œë‹¤.   
  
`ì‚¬ìš©ì B`  
B1 í•˜ë‚˜ì˜ ì‘ì—…ì„ ì‹¤í–‰ ì¤‘  
ì‚¬ìš©ì B ê¸°ì¤€ ì „ì²´ í™”í = 10ì¥ ì¶”ì²¨ê¶Œ â†’ í”„ë¡œì„¸ìŠ¤ B1ì— 10ì¥ì„ í• ë‹¹.  
â†’ ì‹œìŠ¤í…œì€ B1ì˜ `ê¸°ì¤€ í™”í 10ì¥`ì—ì„œ `ì „ì—­ ê¸°ì¤€ í™”í 100ì¥`ìœ¼ë¡œ ë³€í™˜ëœë‹¤.   
  
ë”°ë¼ì„œ ì „ì—­ ì¶”ì²¨ê¶Œ í™”íëŸ‰ (ì´ 200ì¥) ê¸°ì¤€ìœ¼ë¡œ ì¶”ì²¨í•œë‹¤.  
  
![[../../assets/img/Pasted image 20230115110718.png|Pasted image 20230115110718.png]]  
  
  
- **ì¶”ì²¨ê¶Œ ì–‘ë„(ticket transfer)**   
  
ì–‘ë„ë¥¼ í†µí•˜ì—¬ í”„ë¡œì„¸ìŠ¤ëŠ” ì¼ì‹œì ìœ¼ë¡œ ì¶”ì²¨ê¶Œì„ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤.   
  
ì´ ê¸°ëŠ¥ì€ <font style="color:#6082B6">í´ë¼ì´ì–¸íŠ¸/ì„œë²„ í™˜ê²½</font>ì—ì„œ íŠ¹íˆ ìœ ìš©í•˜ë‹¤.   
í´ë¼ì´ì–¸íŠ¸ í”„ë¡œì„¸ìŠ¤ëŠ” ì„œë²„ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ ìì‹ ì„ ëŒ€ì‹ í•´ íŠ¹ì • ì‘ì—…ì„ í•´ë‹¬ë¼ê³  ìš”ì²­í•œë‹¤.   
ì‘ì—…ì´ ë¹¨ë¦¬ ì™„ë£Œë  ìˆ˜ ìˆë„ë¡ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì—ê²Œ ì¶”ì²¨ê¶Œì„ ì „ë‹¬í•˜ê³  ì„œë²„ê°€ ìì‹ ì˜ ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ë™ì•ˆ ì„œë²„ì˜ ì„±ëŠ¥ì„ ê·¹ëŒ€í™”í•˜ë ¤ê³  í•œë‹¤.  
ìš”ì²­ì„ ì™„ìˆ˜í•˜ë©´ ì„œë²„ëŠ” ì¶”ì²¨ê¶Œì„ ë‹¤ì‹œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë˜ëŒë ¤ ì£¼ê³  ë¨¼ì €ì™€ ê°™ì€ ìƒí™©ì´ ëœë‹¤.   
  
- **ì¶”ì²¨ê¶Œ íŒ½ì°½(ticket inlation)**  
ì´ ê¸°ë²•ì—ì„œ í”„ë¡œì„¸ìŠ¤ëŠ” ì¼ì‹œì ìœ¼ë¡œ ìì‹ ì´ ì†Œìœ í•œ ì¶”ì²¨ê¶Œì˜ ìˆ˜ë¥¼ ëŠ˜ì´ê±°ë‚˜ ì¤„ì¼ ìˆ˜ ìˆë‹¤.   
í™”í íŒ½ì°½ ê¸°ë²•ì€ í”„ë¡œì„¸ìŠ¤ë“¤ì´ ì„œë¡œ ì‹ ë¢°í•  ë•Œ ìœ ìš©í•˜ë‹¤.   
  
ì„œë¡œ ì‹ ë¢°í•˜ì§€ ì•ŠëŠ” í”„ë¡œì„¸ìŠ¤ë“¤ì´ ìƒí˜¸ ê²½ìŸí•˜ëŠ” í™˜ê²½ì—ì„œëŠ” ì¢‹ì§€ ëª»í•œ ê¸°ë²•ì´ë‹¤. (í•˜ë‚˜ì˜ ìš•ì‹¬ ë§ì€ í”„ë¡œì„¸ìŠ¤ê°€ ë§¤ìš° ë§ì€ ì–‘ì˜ ì¶”ì²¨ê¶Œì„ ìì‹ ì—ê²Œ í• ë‹¹í•˜ê³  ì»´í“¨í„°ë¥¼ ì¥ì•…í•  ìˆ˜ ìˆë‹¤.)  
  
ë”°ë¼ì„œ ì–´ë–¤ í”„ë¡œì„¸ìŠ¤ê°€ ë” ë§ì€ CPU ì‹œê°„ì„ í•„ìš”ë¡œ í•œë‹¤ë©´ ì‹œìŠ¤í…œì—ê²Œ ì´ë¥¼ ì•Œë¦¬ëŠ” ë°©ë²•ìœ¼ë¡œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ë“¤ê³¼ í†µì‹ í•˜ì§€ ì•Šê³  í˜¼ì ì¶”ì²¨ê¶Œì˜ ê°€ì¹˜ë¥¼ ìƒí–¥ ì¡°ì •í•œë‹¤.  
  
# 3. êµ¬í˜„  
ìŠ¤ì¼€ì¤„ë§ì˜ ê°€ì¥ í° ì¥ì ì€ êµ¬í˜„ì´ ë‹¨ìˆœí•˜ë‹¤ëŠ” ì ì´ë‹¤.  
í•„ìš”í•œ ê²ƒì€ ë‚œìˆ˜ ë°œìƒê¸°ì™€ í”„ë¡œì„¸ìŠ¤ë“¤ì˜ ì§‘í•©ì„ í‘œí˜„í•˜ëŠ” ìë£Œ êµ¬ì¡° (ì˜ˆ, ë¦¬ìŠ¤íŠ¸), ì¶”ì²¨ê¶Œì˜ ì „ì²´ ê°œìˆ˜ ë¿ì´ë‹¤.   
ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•œë‹¤ê³  ê°€ì •í•˜ì.  
  
A, B, C ì„¸ ê°œì˜ í”„ë¡œì„¸ìŠ¤ë¡œ êµ¬ì„±ë˜ê³  ê°ì ëª‡ ì¥ì˜ ì¶”ì²¨ê¶Œì„ ê°€ì§„ë‹¤.  
  
- ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ ê²°ì • ì½”ë“œ   
![[../../assets/img/Pasted image 20230115112114.png|Pasted image 20230115112114.png]]  
```c  
// counter: ë‹¹ì²¨ìë¥¼ ë°œê²¬í–ˆëŠ”ì§€ ì¶”ì í•˜ëŠ”ë° ì‚¬ìš©ë¨  
int counter = 0;  
  
// winner: 0ë¶€í„° ì´ ì¶”ì²¨ê¶Œ ìˆ˜ ì‚¬ì´ì˜ ì„ì˜ì˜ ê°’ì„ ì–»ê¸° ìœ„í•´ ë‚œìˆ˜ ë°œìƒê¸°ë¥¼ í˜¸ì¶œí•¨  
int winner = getrandom(0, totaltickets);  
  
// current: ì‘ì—… ëª©ë¡ì„ íƒìƒ‰í•˜ëŠ” ë° ì‚¬ìš©  
node_t *current = head;  
  
 // í‹°ì¼“ ê°’ > winner ë¥¼ ë§Œì¡±í•  ë•Œê¹Œì§€ ë°˜ë³µ  
 while (current) {  
	 counter = counter + current âˆ’> tickets;  
	 if (counter > winner)  
		 break; // ë‹¹ì²¨ì ë°œê²¬  
	 current = currentâˆ’>next;  
 }  
 // "current" ëŠ” ë‹¹ì²¨ìë¥¼ ê°€ë¦¬í‚´: ë‹¹ì²¨ìê°€ ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ ì¤€ë¹„  
```  
  
  
ìŠ¤ì¼€ì¤„ì„ ê²°ì •í•˜ê¸° ìœ„í•´ ë¨¼ì € ì´ ì¶”ì²¨ê¶Œì˜ ê°œìˆ˜ $(400)^2$ ì¤‘ì—ì„œ í•œ ìˆ«ìë¥¼ ì„ íƒí•´ì•¼ í•œë‹¤.   
300ì´ ì„ íƒë˜ì—ˆë‹¤ê³  í•˜ì.   
ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©° ì¹´ìš´í„° ê°’ì„ ì´ìš©í•˜ì—¬ ë‹¹ì²¨ìë¥¼ ì°¾ì•„ë‚¸ë‹¤ .   
  
í”„ë¡œì„¸ìŠ¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ìˆœíšŒí•˜ë©´ì„œ counterì˜ ê°’ì´ winnerì˜ ê°’ì„ ì´ˆê³¼í•  ë•Œê¹Œì§€ ê° ì¶”ì²¨ê¶Œ ê°œìˆ˜ë¥¼ counterì— ë”í•œë‹¤.  
  
ê°’ì´ ì´ˆê³¼í•˜ê²Œ ë˜ë©´ ë¦¬ìŠ¤íŠ¸ì˜ í˜„ì¬ ì›ì†Œê°€ ë‹¹ì²¨ìê°€ ëœë‹¤.   
  
ë‹¹ì²¨ ë²ˆí˜¸ê°€ 300ì¸ ìš°ë¦¬ì˜ ì˜ˆì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰ëœë‹¤. ë¨¼ì € Aì˜ ì¶”ì²¨ê¶Œ ê°œìˆ˜ê°€ ë”í•´ì ¸ì„œ counter ê°’ì´ 100ìœ¼ë¡œ ì¦ê°€í•œë‹¤. 100ì€ 300ë³´ë‹¤ ì‘ê¸° ë•Œë¬¸ì— ê³„ì† ë£¨í”„ë¥¼ ì‹¤í–‰í•œë‹¤.   
  
ë‹¤ìŒ counterëŠ” 150(Bì˜ ì¶”ì²¨ê¶Œ ê°œìˆ˜)ìœ¼ë¡œ ê°±ì‹ ë˜ê³ , ì•„ì§ 300ë³´ë‹¤ ì‘ê¸° ë•Œë¬¸ì— ë‹¤ì‹œ ìˆœíšŒë¥¼ ê³„ì†í•œë‹¤. ë§ˆì¹¨ë‚´ counterëŠ” 400(í™•ì‹¤íˆ 300ë³´ë‹¤ í¼)ìœ¼ë¡œ ê°±ì‹ ë˜ê³  ë£¨í”„ë¥¼ ë¹ ì ¸ ë‚˜ì˜¤ê²Œ ë˜ê³  currentëŠ” í”„ë¡œì„¸ìŠ¤ C(ë‹¹ì²¨ì)ë¥¼ ê°€ë¦¬í‚¤ê²Œ ëœë‹¤.   
  
ì¼ë°˜ì ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ë©´ ì´ ê³¼ì •ì´ ê°€ì¥ íš¨ìœ¨ì ì´ ëœë‹¤. ì •ë ¬ ìˆœì„œëŠ” ì•Œê³ ë¦¬ì¦˜ì˜ ì •í™•ì„±ì— ì˜í–¥ì„ ì£¼ì§€ëŠ” ì•ŠëŠ”ë‹¤.   
  
ê·¸ëŸ¬ë‚˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ì •ë ¬í•´ ë†“ìœ¼ë©´ ê²€ìƒ‰ íšŸìˆ˜ê°€ ìµœì†Œí™”ë˜ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.   
íŠ¹íˆ, ì ì€ ìˆ˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ëŒ€ë¶€ë¶„ì˜ ì¶”ì²¨ê¶Œì„ ì†Œìœ í•˜ê³  ìˆëŠ” ê²½ìš°ì— íš¨ê³¼ì ì´ë‹¤.  
  
  
# 4. ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ ë¬¸ì œì   
## ë¬¸ì œì  1 : ì‘ì—… ê¸¸ì´ê°€ ì§§ì€ ê²½ìš°  
  
  
  
- $U$ : **ë¶ˆê³µì • ì§€í‘œ(unfairness metric)**   
ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ì˜ ë¬´ì‘ìœ„ì„± ë•Œë¬¸ì— í•œ ì‘ì—…ì´ ë‹¤ë¥¸ ì‘ì—…ë³´ë‹¤ ë¨¼ì € ì¢…ë£Œë  ìˆ˜ ìˆëŠ”ë°, ì´ë¥¼ ì •ëŸ‰í™”í•œ ì§€í‘œ  
ì²« ë²ˆì§¸ ì‘ì—…ì´ ì¢…ë£Œëœ ì‹œê°„ / ë‘ ë²ˆì§¸ ì‘ì—…ì´ ì¢…ë£Œëœ ì‹œê°„ìœ¼ë¡œ ë‚˜ëˆˆ ê°’  
  
- **ì˜ˆì‹œ**  
ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ ë™ì‘ì„ ì‰½ê²Œ ì´í•´í•˜ê¸° ìœ„í•´ì„œ, CPUë¥¼ ê³µìœ í•˜ëŠ” ë‘ ê°œì˜ ì‘ì—…ì˜ ìˆ˜í–‰ ì‹œê°„ì„ ì‚´í´ë³´ì.   
ê° í”„ë¡œì„¸ìŠ¤ëŠ” ê°™ì€ ê°œìˆ˜ì˜ ì¶”ì²¨ê¶Œ (100)ì„ ê°€ì§€ê³  ìˆìœ¼ë©° ì‹¤í–‰ì‹œê°„ R = 10 ë§Œí¼ ë™ì¼í•œ ì‹¤í–‰ ì‹œê°„ì„ ê°–ëŠ”ë‹¤.  
  
ì²« ë²ˆì§¸ ì‘ì—…ì€ ì‹œê°„ 10ì— ì¢…ë£Œ â†’ ë‘ ë²ˆì§¸ ì‘ì—…ì€ 20ì—ì„œ ì¢…ë£Œ  
  
U = $10/20$ = 0.5.   
  
ë‘ ì‘ì—…ì´ ê±°ì˜ ë™ì‹œì— ì¢…ë£Œí•˜ë©´ U ëŠ” 1ì— ê·¼ì ‘í•´ì§„ë‹¤. (ê°€ì¥ ì´ìƒì )  
  
  
![[Pasted image 20230115112256.png | ì¶”ì²¨ê¶Œ ë°°ë¶„ ë°©ì‹ì˜ ê³µì •ì„± ë¶„ì„]]  
  
ì¶”ì²¨ê¶Œ ë°°ë¶„ ë°©ì‹ì˜ ê³µì •ì„± ë¶„ì„ ê·¸ë¦¼ì€ í‰ê· ì ì¸ ë¶ˆê³µì • ì •ë„ë¥¼ ë³´ì´ê³  ìˆë‹¤.   
  
ë‘ ì‘ì—…ì˜ ìˆ˜í–‰ ì‹œê°„ì€ 1ì—ì„œ 1000ê¹Œì§€ ë³€ê²½ì‹œì¼°ìœ¼ë©° 30ë²ˆì”© ì‹¤í–‰ì‹œì¼°ë‹¤.   
ê²°ê³¼ëŠ” ì´ ì¥ì˜ ë§ˆì§€ë§‰ì— ì œê³µë˜ëŠ” ì‹œë®¬ë ˆì´í„°ë¥¼ í†µí•˜ì—¬ ìƒì„±ë˜ì—ˆë‹¤.   
ê·¸ë˜í”„ì—ì„œ ë³´ë“¯ ì‘ì—… ê¸¸ì´ê°€ ê¸¸ì§€ ì•Šì€ ê²½ìš°, <font style="color:indianred">í‰ê·  ë¶ˆê³µì • ì •ë„ëŠ” ì‹¬ê°</font>í•˜ë‹¤.   
ì‘ì—…ì´ ì¶©ë¶„í•œ ê¸°ê°„ ë™ì•ˆ ì‹¤í–‰ë˜ì–´ì•¼ ì¶”ì²¨ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ì›í•˜ëŠ” ê²°ê³¼ì— ê°€ê¹Œì›Œì§„ë‹¤.   
  
ë¬´ì‘ìœ„ì„±ì„ ì´ìš©í•˜ë©´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ë‹¨ìˆœí•˜ê²Œ (ê·¸ëŸ¬ë‚˜ ì–´ëŠì •ë„ ì •í™•í•˜ê²Œ) ë§Œë“¤ ìˆ˜ ìˆì§€ë§Œ, ì •í™•í•œ ë¹„ìœ¨ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤.   
ì§§ì€ ê¸°ê°„ë§Œ ì‹¤í–‰ë˜ëŠ” ê²½ìš°ëŠ” ë” ê·¸ë ‡ë‹¤.   
  
## ë¬¸ì œì  2: ì¶”ì²¨ê¶Œ ë°°ë¶„ ë°©ì‹  
í”„ë¡œì„¸ìŠ¤ë“¤ì—ê²Œ ì¶”ì²¨ê¶Œì„ ëª‡ ê°œì”© ë¶„ë°°í•´ì•¼ í• ì§€ì— ëŒ€í•´ì„œ ë¯¸í•´ê²° ìƒíƒœì´ë‹¤.  
ì‹œìŠ¤í…œ ë™ì‘ì´ ì¶”ì²¨ê¶Œ í• ë‹¹ ë°©ì‹ì— ë”°ë¼ í¬ê²Œ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— ìƒë‹¹íˆ ì–´ë ¤ìš´ ë¬¸ì œì´ë‹¤.  
ì£¼ì–´ì§„ ì‘ì—… ì§‘í•©ì— ëŒ€í•œ â€œì¶”ì²¨ê¶Œ í• ë‹¹ ë¬¸ì œâ€ëŠ” ì—¬ì „íˆ ë¯¸í•´ê²° ìƒíƒœë‹¤.  
  
ê¶ì—¬ì§€ì±…ìœ¼ë¡œ ì‚¬ìš©ìê°€ ê°€ì¥ ì˜ ì•Œê³  ìˆë‹¤ê³  ê°€ì •í•˜ê³ ,  ê° ì‚¬ìš©ìì—ê²Œ ì¶”ì²¨ê¶Œì„ ë‚˜ëˆ„ì–´ ì¤€ í›„ ì‚¬ìš©ìê°€ ì•Œì•„ì„œ ì‹¤í–‰ì‹œí‚¤ê³ ì í•˜ëŠ” ì‘ì—…ë“¤ì—ê²Œ ì¶”ì²¨ê¶Œì„ ë°°ë¶„í•  ìˆ˜ ìˆì§€ë§Œ ì™„ë²½í•œ í•´ê²° ë°©ë²•ì´ ì•„ë‹ˆë‹¤.  
  
  
  
# 5. ê²°ì •ë¡ ì  (Deterministic) ë°©ë²•: ë³´í­ ê°œë… ì‚¬ìš©  
  
## ë³´í­ ìŠ¤ì¼€ì¤„ë§(stride scheduling)  
: ê²°ì •ë¡ ì  ê³µì • ë°°ë¶„ ìŠ¤ì¼€ì¤„ëŸ¬  
  
ë³´í­ ìŠ¤ì¼€ì¤„ë§ì€ ê° ìŠ¤ì¼€ì¤„ë§ ì£¼ê¸°ë§ˆë‹¤ ì •í™•í•œ ë¹„ìœ¨ë¡œ CPUë¥¼ ë°°ë¶„í•œë‹¤.   
  
ì‹œìŠ¤í…œì˜ ê° ì‘ì—… í”„ë¡œì„¸ìŠ¤ëŠ” ë³´í­ì„ ê°€ì§€ê³  ìˆë‹¤.   
ë³´í­ì€ ìì‹ ì´ ê°€ì§€ê³  ìˆëŠ” `ì¶”ì²¨ê¶Œ ìˆ˜ì— ë°˜ë¹„ë¡€í•˜ëŠ” ê°’`ì´ë‹¤.   
  
ì„ì˜ì˜ í° ê°’ì„ ê°ìì˜ ì¶”ì²¨ê¶Œ ê°œìˆ˜ë¡œ ë‚˜ëˆ„ì–´ ë³´í­ì„ ê³„ì‚°í•  ìˆ˜ ìˆë‹¤.   
stride = (A large number) / (the number of tickets of the process)  
  
![[../../assets/img/Pasted image 20230115130741.png|Pasted image 20230115130741.png]]  
[ì‚¬ì§„ ìë£Œ ì¶œì²˜](https://www.semanticscholar.org/paper/Stride-Scheduling%3A-Deterministic-Proportional-Share-Waldspurger/aecd975dde84fcc1bd9653ee2aa339d99bfe264e/figure/1)  
  
í”„ë¡œì„¸ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œë§ˆë‹¤ passë¼ëŠ” ê°’ (= counter)ì„ ë³´í­ë§Œí¼ ì¦ê°€ì‹œì¼œ ì–¼ë§ˆë‚˜ CPUë¥¼ ì‚¬ìš©í•˜ì˜€ëŠ”ì§€ë¥¼ ì¶”ì í•œë‹¤.  
ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ë³´í­ê³¼ pass ê°’ì„ ì‚¬ìš©í•˜ì—¬ ì–´ëŠ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¬ì§€ ê²°ì •í•œë‹¤.  
ê°€ì¥ ì‘ì€ pass ê°’ì„ ê°€ì§„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„ íƒí•œë‹¤.  
í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰ì‹œí‚¬ ë•Œë§ˆë‹¤ pass ê°’ì„ ë³´í­ë§Œí¼ì”© ì¦ê°€ì‹œí‚¨ë‹¤.  
  
```c  
current = remove_min(queue); // pass ê°’ì´ ìµœì†Œì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ ì„ íƒ  
schedule(current); // ìì›ì„ íƒ€ì„ í€€í…€ë§Œí¼ ì„ íƒëœ í”„ë¡œì„¸ìŠ¤ì—ê²Œ í• ë‹¹  
currentâˆ’>pass += currentâˆ’>stride; // ë‹¤ìŒ pass ê°’ì„ ë³´í­ ê°’ì„ ì´ìš©í•˜ì—¬ ê°±ì‹   
insert(queue, current); // ë‹¤ì‹œ íì— ì €ì¥í•œë‹¤.  
```  
  
- **ì˜ˆì‹œ**  
  
ì„ì˜ì˜ í° ìˆ«ì = **10,000** ì¼ ê²½ìš°, ê° í”„ë¡œì„¸ìŠ¤ì— í• ë‹¹ëœ ì¶”ì²¨ê¶Œì€ ë‹¤ìŒê³¼ ê°™ë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ë³´í­ ê°’ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.   
  
  
| Process | Tickets | Stride |  
| ------- | ------- | ------ |  
| <font style="color:indianred">A</font>       | 100     | 100    |  
| <font style="color:#8A9A5B">B</font>       | 50      | 200    |  
| <font style="color:#6082B6">C</font>       | 250     | 40     |   
  
  
![[../../assets/img/Pasted image 20230115115810.png|Pasted image 20230115115810.png]]  
  
  
  
  
CëŠ” 5ë²ˆ, AëŠ” 2ë²ˆ, BëŠ” 1 ë²ˆë§Œ ì‹¤í–‰ë˜ì—ˆë‹¤.   
ì´ íšŸìˆ˜ëŠ” ê°ì ê°€ì§„ ì¶”ì²¨ê¶Œì˜ ê°œìˆ˜ 250, 100, 50ê³¼ ì •í™•íˆ ë¹„ë¡€í•œë‹¤.   
  
ê°ìì˜ pass ê°’ì€ ëª¨ë‘ 0ì—ì„œ ì‹œì‘í•œë‹¤.  
ì²˜ìŒì—ëŠ” pass ê°’ì´ ê°™ê¸° ë•Œë¬¸ì— ì•„ë¬´ í”„ë¡œì„¸ìŠ¤ë‚˜ ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤.  
  
ì„ì˜ë¡œ Aë¥¼ ì„ íƒí–ˆë‹¤ê³  ê°€ì •í•˜ì.  
1. Aê°€ ì‹¤í–‰ëœë‹¤.  
2. íƒ€ì„ ìŠ¬ë¼ì´ìŠ¤ë§Œí¼ ì‹¤í–‰ë˜ê³  ì¢…ë£Œë  ë•Œ pass ê°’ì„ 100ìœ¼ë¡œ ê°±ì‹ í•œë‹¤.  
3. Bê°€ ì‹¤í–‰ë˜ê³  í•´ë‹¹ pass ê°’ì´ 200ìœ¼ë¡œ ê°±ì‹ ëœë‹¤.   
4. Cë¥¼ ì‹¤í–‰í•˜ê³ , pass ê°’ì€ 40ìœ¼ë¡œ ê°±ì‹ ëœë‹¤.  
5. ì´ ì‹œì ì—ì„œ ì•Œê³ ë¦¬ì¦˜ì€ ê°€ì¥ ì‘ì€ pass ê°’ì„ ê°€ì§„ Cë¥¼ ì„ íƒí•˜ê³  80 ìœ¼ë¡œ ê°±ì‹ í•œë‹¤ (Cì˜ ë³´í­ì€ 40ì´ë‹¤).   
6. Cê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ê³  (ì•„ì§ ìµœì†Œ pass ê°’) 120 ìœ¼ë¡œ ê°±ì‹ ëœë‹¤.   
7. Aê°€ ì‹¤í–‰ë˜ê³  200ìœ¼ë¡œ ê°±ì‹ ëœë‹¤ (ì´ì œ Bì™€ ê°™ì•„ì§„ë‹¤).   
8. Cê°€ ë‘ ë²ˆ ë” ì‹¤í–‰ë˜ê³  pass ê°’ì€ 160ì„ ê±°ì³ 200ìœ¼ë¡œ ê°±ì‹ ëœë‹¤.   
  
ì´ ì‹œì ì—ì„œ ëª¨ë“  pass ê°’ì€ ë‹¤ì‹œ ê°™ì•„ì§€ê²Œ ë˜ê³  ì´ëŸ° ì„ íƒ ê³¼ì •ì´ ê³„ì† ë°˜ë³µëœë‹¤.   
  
  
  
ê·¸ëŸ°ë°ë„ ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ   
  
1. ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ì€ í”„ë¡œì„¸ìŠ¤ ë‹¹ ìƒíƒœ ì •ë³´ê°€ í•„ìš” ì—†ë‹¤.  
2. CPU ì‚¬ìš© í˜„í™©, pass ê°’ ë“±ì„ ìœ ì§€í•  í•„ìš”ê°€ ì—†ë‹¤.  
3. ì¶”ì²¨ ìŠ¤ì¼€ì¤„ë§ì—ì„œëŠ” ìƒˆ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‰½ê²Œ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.  
   ë³´í­ ìŠ¤ì¼€ì¤„ë§ì˜ ê²½ìš°, pass ê°’ì´ ë§Œì•½ 0 ìœ¼ë¡œ ì§€ì •ëœë‹¤ë©´ CPUë¥¼ ë…ì í•˜ê²Œ ë  ê²ƒì´ë‹¤.   
  
ìƒˆ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¶”ê°€í•  ë•Œ, ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ ê°€ì§„ ì¶”ì²¨ê¶Œì˜ ê°œìˆ˜, ì „ì²´ ì¶”ì²¨ê¶Œì˜ ê°œìˆ˜ë§Œ ê°±ì‹ í•˜ê³  ìŠ¤ì¼€ì¤„í•œë‹¤.   
  
  
  
## The Linux Completely Fair Scheduling (CFS)  
[Operating System Examples - Scheduling Chapter 5.6,](https://slideplayer.com/slide/9528091/)  
[IBM Developer](https://developer.ibm.com/tutorials/l-completely-fair-scheduler/)  
[Arm Linux Kernel Hacks : [ë¦¬ëˆ…ìŠ¤ì»¤ë„] ìŠ¤ì¼€ì¤„ë§: CFS ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì´ë£¨ëŠ” ì£¼ìš” ê°œë… ì•Œì•„ë³´ê¸°](http://rousalome.egloos.com/9999939)  
[7ê°• - CFS](https://youjinjung.me/linuxkernel/7/)  
[Linux Scheduler â€“ CFS and Latency (sched_min_granularity_ns and sched_latency_ns) | oakbytes](https://oakbytes.wordpress.com/2012/06/06/linux-scheduler-cfs-and-latency/)  
  
  
  
- **Non-fixed timeslice.**  
	â†’ CFS assigns process's timeslice a proportion of the processor.  
  
- **Priority**  
	Enables control over priority by using nice value.  
  
- **Efficient data structure**  
	Use red-black-tree for efficient search, insertion and deletion of a process.  
  
### ê°œë…  
  
  
nê°œì˜ processì—ê²Œ ê°ê° 1/n process time ì œê³µ  
íŠ¹ì • ì‹œê°„ ì•ˆì— nê°œì˜ í”„ë¡œì„¸ìŠ¤ê°€ ëª¨ë‘ ë™ì¼í•œ ì‹œê°„ ë™ì•ˆ ì‹¤í–‰  
  
í”„ë¡œì„¸ìŠ¤ë¥¼ ë¬´í•œíˆ ì‘ì€ ì‹œê°„ ë‹¨ìœ„ë¡œ ìŠ¤ì¼€ì¤„ë§  
  
- ex) ë‘ í”„ë¡œì„¸ìŠ¤ë¥¼ 10msë™ì•ˆ ìŠ¤ì¼€ì¤„ í•  ë•Œ  
	unix - 5msì”© ìˆ˜í–‰  
	cfs - 10msë™ì•ˆ ë‘ í”„ë¡œì„¸ìŠ¤ë¥¼ ê°ê° 50%ì”© ë™ì‹œì— ì‹¤í–‰  
  
  
  
- **ì˜ˆì œ**  
ABCD í”„ë¡œì„¸ìŠ¤ ì¤‘ CD í”„ë¡œì„¸ìŠ¤ê°€ ì™„ë£Œëœ ìƒíƒœì¼ ê²½ìš°  
  
![[../../assets/img/Pasted image 20230115121651.png|Pasted image 20230115121651.png]]  
### Define The scheduler period factor  
- **sched_min_granularity_ns** (lower bound)  
	- minimum time a task will be be allowed to run on CPU before being pre-empted out.  
	- Ensure that not too much time is spent in scheduling overhead, When there are too many process running.  
	- By default, it is set to 4ms. So by default, any task will run atleast 4ms before getting pre-empted out.  
  
- **sched_latency_ns**  
	- cfsê°€ ì„¤ì •í•œ ê°€ì¥ ì‘ì€ ìŠ¤ì¼€ì¤„ë§ ë‹¨ìœ„ (ìµœì†Œ ì–¼ë§Œí¼ ìˆ˜í–‰í•˜ê² ë‹¤ì˜ ì •ìˆ˜ê°’ì˜ ë ˆì´í„´ì‹œ)  
		- By default, this is set to 20ms.  
		- the period in which all run queue tasks are scheduled atleast once.  
		- process's timeslice = sched_latency / the number of process  
  
- **Calculating Schedule Latency**  
How does scheduler period depend on `sched_latency_ns` and `sched_min_granularity_ns`?  
If number of runnable tasks does not exceed `sched_latency_ns`/`sched_min_granularity_ns`  
scheduler period = `sched_latency_ns`  
else  
$$scheduler\;period (smallest\;time\;slice) = (number\;of\;processes) * sched\_min\_granularity\_ns$$  
  
  
**Example â€“ In Linux system with default values, there are two processes, both busy waiting.   
  What will be the time slice of each task?**  
By default, `sched_latency_ns` = 20ms and `sched_min_granularity_ns` = 4ms  
$$Time \;slice = scheduling \;period * {taskâ€™s \;weight \over total \;weight \;of \;tasks \;in \;the \;run \;queue}$$  
Number of running tasks = 2  
Weight of each task will be same. Hence (taskâ€™s weight/total weight of tasks in the run queue) will be 1/2  
Hence time slice will be 20ms * 0.5 or 10ms  
  
  
**What happens when there are 20 such busy wait processes?**  
Ideally, each task should get 1 ms (=20ms * 1/20). But this is less than `sched_min_granularity_ns`.  
`sched_min_granularity_ns` decides the minimum time a task will run.   
  
By default, `sched_min_granularity_ns` is set to 4ms.  
So in the case of 20 busy wait processes, each process will run for 4ms before it is preempted.  
  
  
### Nice value  
- niceëŠ” time slice ëŒ€ì‹  processor time ë¹„ìœ¨ì˜ ê°€ì¤‘ì¹˜ ê³„ì‚°(í¼ì„¼í‹°ì§€)ì— ì‚¬ìš©  
  A nice value is assigned to each task.  
	- CFS enables controls over process priority.  
	- Nice parameter is integer value and can be set from `-20` to `+19`  
	- The nice value is mapped to a <font style="color:indianred">weight</font> (value is not important)  
		- eg. - 20 is mapped to 88761m 0 is mapped to 1024  
	- Lower nice value indicates a higher relative priority.  
	- Tasks with lower nice values receive a higher proportion of CPU processing time than tasks with hisher nice values.  
	- The default nice value is `0`  
  
![[../../assets/img/Pasted image 20230115122556.png|Pasted image 20230115122556.png]]  
$\quad$   
**The general idea is that**  
1. Every process that changes nice value up by one level gets 10% less CPU power.  
2. Every process that changes nice value down by one gets 10% more CPU power  
3. The mapping from nice values to weights uses an array  
4. The array contains one entry for each nice level.  
5. The multiplier between the entries is 1.25  
  
$\quad$   
  
 - **Time Slice Calculation**  
	 - <font style="color:indianred">a targeted latency (TL)</font>:    
		 - an interval of time during which every runnable task should run at least once.   
		   (= cfsê°€ ì„¤ì •í•œ ê°€ì¥ ì‘ì€ ìŠ¤ì¼€ì¤„ë§ ë‹¨ìœ„ (ìµœì†Œ ì–¼ë§Œí¼ ìˆ˜í–‰í•˜ê² ë‹¤ì˜ ì •ìˆ˜ê°’ì˜ ë ˆì´í„´ì‹œ))  
		 - Linuxì—ì„œëŠ” 20ms (sched_latency_ns, ì‹œìŠ¤í…œë§ˆë‹¤ ì •í•´ì ¸ìˆë‹¤)  
		 - ex) targeted latencyê°€ 20msì´ë©´  
			 - 2ê°œì˜ ì‘ì—…ì´ ìˆìœ¼ë©´ - ê°ê° 10msì”© ìˆ˜í–‰ (priorityì™€ ë¬´ê´€)(niceê°’ ê°™ìŒ)  
			 - 20ê°œì˜ ì‘ì—…ì´ ìˆìœ¼ë©´ - ê°ê° 1msì”© ìˆ˜í–‰  
			 - 40ê°œì˜ ì‘ì—…ì´ ìˆìœ¼ë©´ - ê°ê° 0.5msì”© ìˆ˜í–‰  
	 - <font style="color:indianred">Time slice</font> for a $task_i = TL * W_i / (Sum\,of\,all\,W_i)$   
	   $\quad$ $W_i$ (ê°€ì¤‘ì¹˜): $task_i$ ì˜ nice ê°’ì´ ë³€ê²½ëœ ê°’ (nice, weightì— ëŒ€í•œ tableì´ ì¡´ì¬í•œë‹¤.)  
$\quad$   
- **Time Slice Calculation Example**  
	- Targeted latency = 20 ms  
	- Two tasks, $t_1$ and $t_2$, with nice values of 0  
	- The weight value for nice 0 is 1,024  
	- The share for each task is $1024/(1024+1024) = 0.5$   
	  and thus each task will have a <font style="color:#8A9A5B">â€œtime sliceâ€ of 10 ms</font>  
  
$\quad$   
- **Time Slice Calculation Example 2**  
	- Targeted latency = 20 ms  
	- Two tasks, $t_1$ and $t_2$, with nice values of 0 and 5 respectively   
	- The weight value for nice 0 is 1,024 and the wight for nice 5 is 335   
	- The share for task $t_1$ is $1024/(1024+335) = 0.75$ and thus  
		- task $t_1$ will have a <font style="color:#8A9A5B">â€œtime sliceâ€ of 0.75*20 = 15 ms</font>  
	- The share for task $t_2$ is $335/(1024+335) = 0.25$   
		- task $t_2$ will have a <font style="color:#8A9A5B">â€œtime sliceâ€ of 20*0.25 = 5 ms</font>  
  
$\quad$   
- **Picking the next process**  
	- Pick process with the weighted minimum runtime so far  
	- <font style="color:indianred">The virtual run time (vruntime)</font> of a task is the actual runtime weighted by its niceness   
	- The value of <font style="color:#6082B6">vruntime</font> is used by the scheduler to determine the next process to run   
	- Process with the smallest <font style="color:#6082B6">vruntime</font> is selected to run next  
  
$\quad$   
  
- **vruntime** (Virtual Runtime, ê°€ìƒ ì‹¤í–‰ ì‹œê°„)  
  task(i)ê°€ i/oë¥¼ ê¸°ë‹¤ë¦¬ê¸° ìœ„í•´ì„œ cpuì—ì„œ ë‚˜ì˜¤ê±°ë‚˜ time sliceë¥¼ ëª¨ë‘ ì†Œëª¨í•´ì„œ cpuì—ì„œ ì¶”ì¶œë˜ë©´ ë³€ê²½ëœ vruntimeë¥¼ ê°€ì§€ê²Œ ëœë‹¤.  
  schedulerê°€ í˜¸ì¶œë  ë•Œë§ˆë‹¤ í˜„ì¬ ìˆ˜í–‰ì¤‘ì¸ taskì˜ vruntimeì„ ê°±ì‹ í•œë‹¤.  
  taskë§ˆë‹¤ ìˆëŠ” ê°€ìƒ ìˆ˜í–‰ì‹œê°„ìœ¼ë¡œ, niceê°’ì´ í¬ë©´ í´ìˆ˜ë¡ ì‹¤ì œ ì‹œê°„ë³´ë‹¤ ë¹ ë¥´ê²Œ ì§€ë‚˜ê°„ë‹¤ (ì‹¤í–‰ì‹œê°„ì´ ì‘ë‹¤.)  
	- <font style="color:indianred">High nice values</font> should result in <font style="color:indianred">less CPU time</font> allocated to a process  
	  â†’ ì´ëŸ° ê²½ìš° ê°€ìƒì ìœ¼ë¡œ 20ms ìˆ˜í–‰ë˜ê²Œ ëŠê»´ì§€ë„ë¡ í•´ì£¼ëŠ” ê²ƒ  
	- This implies that <font style="color:#6082B6">vruntime</font> cannot be the same as the real runtime  
	- Denote how long the process has been executing.  
	- Per-process variable.  
	- Increase in **proportion with physical (real) time** when it runs.  
	- CFS will pick the process with **the lowest vruntime** to run next.  
  
  
  
  
- **Virtual Runtime Example**  
$\quad$Assume a process runs for 200 milliseconds  
$\quad$$\quad$Nice value = 0: <font style="color:#6082B6">vruntime</font> will be 200 milliseconds  
$\quad$$\quad$Nice value < 0 : <font style="color:#6082B6">vruntime</font> will be less than 200 milliseconds   
$\quad$$\quad$Nice value > 0 : <font style="color:#6082B6">vruntime</font> will be greater than 200 milliseconds   
  
  
  
- **Calculating vruntime**   
	- Let $runtime_i$ represent the amount of time spent using the CPU when a process has the CPU   
	- <font style="color:#6082B6">vruntime</font> is incremented by   
		- $$vruntime_i = vruntime_i +{ runtime_i * weight_0 \over weight_i}$$   
		- where $weight_0$ is the weight of $nice\;value_0$  
		- $weight_i$ is the weight of $nice\;value_i$  
	- We refer to $weight_0 /weight_i$ as the <font style="color:indianred">decay factor</font>   
	- Weights of nice values are precomputed to avoid runtime overhead  
  
$\quad$   
- **CFS Example Weights**  
  
| Nice Value | Weight | Decay Factor     |  
| ---------- | ------ | ---------------- |  
| - 5        | 3121   | 1024/3121 = 0.33 |  
| -1         | 1277   | 1024/1277 = 0.80 |  
| 0          | 1024   | 1024/1024 = 1    |  
| 1          | 820    | 1024/820 = 1.24  |  
| 5          | 335    | 1024/335 = 3.05         |  
  
  
- **Using vruntime Example**  
	- Assume two tasks $t_1$ and $t_2$ with   
		- nice values of 0 and 5 respectively   
		- $vruntime_0$ and $vruntime_1$ are initially zero   
		- Decay factors of 1 and 3.05 respectively  
		- Assume $t_1$ runs for 200 milliseconds and t 2 runs for 100 milliseconds which is followed by a lot of other tasks   
			- vruntime 0 is 200 milliseconds   
			- vruntime 1 is 305 milliseconds  
		- $t_1$ will be selected before $t_2$ for execution  
		- Letâ€™s say that t 1 runs again for 200 milliseconds; $vruntime_0$ is now 400 milliseconds  
		- $t_2$ will now be selected before $t_1$ for execution  
  
- **Task Selection**  
![[../../assets/img/Pasted image 20230115154605.png|Pasted image 20230115154605.png]]  
  
Efficiently find the process with minimum virtual runtime. ($O(logn)$)  
The key for each node is the <font style="color:#6082B6">vruntime</font> of the corresponding task.  
To pick the next task to run, simply take the leftmost node.   
This node is pointed to by a variable to reduce traversals  
  
  
### Dealing with I/O and Sleeping processes  
- Avoid the situation where some process monopolizes the CPU, if porcess have significantly small vruntime after sleeping.  
- Set the vruntime of process to the minimum value found in tree when it wakes up.  
- Process that sleep for short periods of time frequently do not ever get their fair share of the CPU.  
  
> **Tip: Processes vs. threads**  
> Linux incorporates process and thread scheduling by treating them as one in the same.   
> A process can be viewed as a single thread, but a process can contain multiple threads that share some number of resources (code and/or data).  
  
# 7. ìš”ì•½  
ë¹„ë¡€ ë°°ë¶„ ìŠ¤ì¼€ì¤„ë§ì˜ ê°œë…  
ì¶”ì²¨ê¶Œ ìŠ¤ì¼€ì¤„ë§  
ë³´í­ ìŠ¤ì¼€ì¤„ë§  
  
ì¶”ì²¨ê¶Œ ìŠ¤ì¼€ì¤„ë§ì€ ë¬´ì‘ìœ„ì„± (randomness) ì„ ì‚¬ìš©í•œë‹¤.  
ë³´í­ ìŠ¤ì¼€ì¤„ë§ì€ ê°™ì€ ëª©ì ì„ ê²°ì •ì  ë°©ë²•ìœ¼ë¡œ ë‹¬ì„±í•œë‹¤.   
- CPU ìŠ¤ì¼€ì¤„ëŸ¬ë¡œì„œ ë„ë¦¬ ì‚¬ìš©ë˜ê³  ìˆì§€ ì•ŠëŠ” ì´ìœ   
1. **ì…ì¶œë ¥**ê³¼ ë§ë¬¼ë ¸ì„ ë•Œ, ì œëŒ€ë¡œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.  
2. **ì¶”ì²¨ê¶Œ í• ë‹¹**ì´ë¼ëŠ” ì–´ë ¤ìš´ ë¬¸ì œê°€ ë¯¸í•´ê²° ìƒíƒœ ex) ë¸Œë¼ìš°ì €ì— ì–¼ë§ˆë‚˜ ì¶”ì²¨ê¶Œì„ í• ë‹¹í•´ì•¼ í•˜ëŠ”ê°€?   
  
ë²”ìš© ìŠ¤ì¼€ì¤„ëŸ¬ (ì•ì„œ ì–¸ê¸‰í•œ MLFQ ê·¸ë¦¬ê³  ë‹¤ë¥¸ ìœ ì‚¬ Linux ìŠ¤ì¼€ì¤„ëŸ¬ ë“±)ëŠ” ê·¸ëŸ¬í•œ ë¬¸ì œë¥¼ ë” ì§ê´€ì ìœ¼ë¡œ í•´ê²°í•´ì„œ ì”€  
  
  
ë¹„ë¡€ ë°°ë¶„ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” ì¶”ì²¨ê¶Œ í• ë‹¹ëŸ‰ì„ ë¹„êµì  ì •í™•í•˜ê²Œ ê²°ì •í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì—ì„œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤.   
ì˜ˆë¥¼ ë“¤ì–´, ê°€ìƒí™” ë°ì´í„° ì„¼í„°ì—ì„œ Windows ê°€ìƒ ë¨¸ì‹ ì— CPU ì‚¬ì´í´ì˜ 1/4ì„ í• ë‹¹í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” Linux ì‹œìŠ¤í…œì— í• ë‹¹í•˜ê³  ì‹¶ì€ ê²½ìš° ë¹„ë¡€ ë°°ë¶„ì´ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì´ë‹¤.   
